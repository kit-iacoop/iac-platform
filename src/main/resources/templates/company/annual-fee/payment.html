<link href="/css/annual-fee/payment.css" rel="stylesheet" type="text/css">
<script src="/js/annual-fee/payment.js"></script>

<div class="current-info">
    [[${accountDTO.name}]]은 현재 [[${accountDTO.grade}]] 등급입니다.
</div>
<div class="main-calculate-wrapper">
    <div class="select-grade-wrapper">
        <select id="annual-fee-for-grade" onchange="changePrice()">
            <option>선택</option>
            <option th:each="gradePolicy: ${gradePolicyDTOS}" th:value="${gradePolicy.price}" th:utext="${gradePolicy.grade}" 
            th:selected="${gradePolicy.grade == accountDTO.grade}"></option>
        </select>
    </div>
    <div class="cash-calculate-wrapper">
        <div class="original-price">
            <p id="original-price"></p>원
        </div>
        <div class="using-point-area">
            <input id="use-point" type="text"/>
            <button onclick="discount()">사용</button>
            <button onclick="allUseDiscount()">모두 사용</button>
            보유: <p id="my-point">[[${accountDTO.point}]]</p>포인트
        </div>
        <div class="sale-price">
            <p id="sale-price"></p>원
        </div>
    </div>
</div>
<div class="btn-wrapper">
    <button onclick="postRequest()">이체</button>
</div>

<script th:inline="javascript">
    $(document).ready(function() {
        let currentGrade = [[${accountDTO.grade}]];
        let gradePolicyArr = [[${gradePolicyDTOs}]];
        var originalPrice = document.getElementsByClassName("original-price")[0];
        var salePrice = document.getElementsByClassName("sale-price")[0];
        console.log(currentGrade);
        console.log(gradePolicyArr);
        gradePolicyArr.forEach(function(policy) {
            if(currentGrade == policy.grade) {
                originalPrice.innerHTML="<p id=\"original-price\">"+ policy.price + "<p>원";
                salePrice.innerHTML="<p id=\"sale-price\">"+ policy.price + "<p>원";
            }
        });
    });

    function postRequest() {
        var point = document.getElementById("use-point");
        var cash = document.getElementById("sale-price");
        var sendData = {
            "point": point.value,
            "cash": cash.textContent
        };
        console.log(JSON.stringify(sendData));
        $.ajax({
            method: "POST",
            url: "/company/annual-fee/payment-application",
            traditional: true,
            contentType: 'application/json',
            data: JSON.stringify(sendData),
            beforeSend: function (xhr) {
                /*<![CDATA[*/
				xhr.setRequestHeader(/*[[${_csrf.headerName}]]*/,/*[[${_csrf.token}]]*/);
                /*]]*/
			}
        })
        .done(function() {
            alert("계좌번호: 농협 123412-12-1234123\n자정까지 입급 바랍니다.");
        });
    };
</script>